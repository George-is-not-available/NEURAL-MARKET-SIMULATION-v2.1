<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>高德地图API测试</title>
    <style>
        #map { width: 100%; height: 400px; }
        #status { margin: 20px 0; padding: 10px; background: #f0f0f0; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>高德地图API测试</h1>
    <div id="status">正在加载...</div>
    <div id="map"></div>

    <script>
        // 设置安全密钥
        window._AMapSecurityConfig = {
            securityJSCode: 'cea99f47726c5e7712f7b851201866aa'
        };

        // 动态加载高德地图API
        function loadAMapScript() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://webapi.amap.com/maps?v=2.0&key=ef3c3095b51b10259a39ac4216e81f1f&callback=initMap';
                script.onerror = reject;
                document.head.appendChild(script);
                
                // 设置全局回调
                window.initMap = resolve;
            });
        }

        // 更新状态
        function updateStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = isError ? 'error' : 'success';
        }

        // 初始化地图
        function initializeMap() {
            try {
                const map = new AMap.Map('map', {
                    center: [116.397428, 39.90923],
                    zoom: 13
                });
                
                // 添加标记
                const marker = new AMap.Marker({
                    position: [116.397428, 39.90923],
                    title: '测试标记'
                });
                
                map.add(marker);
                updateStatus('地图加载成功！');
                
            } catch (error) {
                updateStatus('地图初始化失败: ' + error.message, true);
            }
        }

        // 开始测试
        async function testAMap() {
            try {
                updateStatus('正在加载高德地图API...');
                await loadAMapScript();
                updateStatus('API加载成功，正在初始化地图...');
                initializeMap();
            } catch (error) {
                updateStatus('API加载失败: ' + error.message, true);
            }
        }

        // 启动测试
        testAMap();
    </script>
</body>
</html>